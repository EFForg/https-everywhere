<!--
	Problematic subdomains:

		- gmodules.com			(503, CN: www.google.com)
		- www.gmodules.com		(503, CN: *.googleusercontent.com)


	Partially covered domains:

		- (www.)gmodules.com		(â†’ www.google.com)


	Fully covered domains:

		- *.clients.google.com:

			- linkhelp

		- *.storage.googleapis.com

		- gstatic.com subdomains:

			- csi

		- encrypted-tbn\d.gstatic.com
		- t\d.gstatic.com

-->
<ruleset name="Google APIs">

	<target host="gmodules.com" />
	<target host="www.gmodules.com" />
	<target host="google.com" />
	<target host="www.google.com" />
	<target host="apis.google.com" />
	<target host="*.apis.google.com" />
	<target host="*.clients.google.com" />
	<target host="*.google-analytics.com" />
	<target host="*.googleapis.com" />
	<target host="*.commondatastorage.googleapis.com" />
	<target host="gstatic.com" />
	<target host="*.gstatic.com" />
	<target host="api.recaptcha.net" />
	<target host="gdata.youtube.com" />


	<rule from="^http://(?:www\.)?gmodules\.com/ig/images/"
		to="https://www.google.com/ig/images/" />

	<!--	jsapi was causing problems on some sites that embed google maps:
		https://trac.torproject.org/projects/tor/ticket/2335
		Apparently now fixed; thanks, Google!
							-->
	<rule from="^http://(?:www\.)?google\.com/(afsonline/|chart|jsapi|recaptcha/|uds)"
		to="https://www.google.com/$1" />

	<rule from="^http://(api|[\w-]+\.client)s\.google\.com/"
		to="https://$1s.google.com/" />

	<rule from="^http://chart\.apis\.google\.com/chart"
		to="https://chart.googleapis.com/chart" />

	<rule from="^http://(?:ssl|www)\.google-analytics\.com/"
		to="https://ssl.google-analytics.com/" />

	<rule from="^http://(ajax|chart|fonts|www)\.googleapis\.com/"
		to="https://$1.googleapis.com/" />

	<rule from="^http://([^@:\./]+\.)?(commondata)?storage\.googleapis\.com/"
		to="https://$1$2storage.googleapis.com/" />

	<!--	There is an interesting question about whether we should
		append &strip=1 to all cache URLs.  This causes them to load
		without images and styles, which is more secure but can look
		worse.
			Without &strip=1, the images and styles from the cached
		pages still load from the original, typically unencrypted, page.
			With &strip=1, the cached page will be text-only and
		will come exclusively from Google's HTTPS server.
									-->
	<rule from="^http://(?:www\.|ssl\.)?gstatic\.com/"
		to="https://ssl.gstatic.com/" />

	<rule from="^http://(csi|encrypted-tbn\d|g0|[\w-]+\.metric|t\d)\.gstatic\.com/"
		to="https://$1.gstatic.com/" />

	<rule from="^http://api\.recaptcha\.net/"
		to="https://www.google.com/recaptcha/api/" />

	<rule from="^http://gdata\.youtube\.com/"
		to="https://gdata.youtube.com/" />

  <exclusion pattern="^http://gdata\.youtube\.com/crossdomain\.xml" />

</ruleset>
