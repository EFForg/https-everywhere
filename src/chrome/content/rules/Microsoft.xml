<!--
	commit msg:

		https://github.com/EFForg/https-everywhere/issues/672
		https://trac.torproject.org/projects/tor/ticket/11380


	For rules causing false/broken MCB, see Microsoft.com-falsemixed.xml.

	For problematic rules, see Microsoft-mismatches.xml.


	Other Microsoft rulesets:

		- Acik_Akademi.com.xml
		- AKA.ms.xml
		- ASP.NET.xml
		- ASPNETcdn.com.xml
		- Bing.xml
		- Ch9.ms.xml
		- Codeplex.xml
		- DreamSpark.com.xml
		- Get_Tag.mobi.xml
		- Halo.xml
		- Live.xml
		- Microsoft-Atlas.xml
		- Microsoft_Online_Services.xml
		- Microsoft_Store.xml
		- Modern.IE.xml
		- Moreinterop.com.xml
		- MSDN.xml
		- Msecnd.net.xml
		- MSN.xml
		- Newsvine.com.xml
		- OneDrive.com.xml
		- Outlook_Live.xml
		- Photosynth.xml
		- Skype.xml
		- S-msn.com.xml
		- Sway.xml
		- System_Center_Advisor.com.xml
		- Technet.com.xml
		- Virtualearth.net.xml
		- Windows_Azure.xml
		- Windows.com.xml
		- Windows.net.xml
		- Windows_Phone.xml
		- Xbox.xml


	CDN buckets:

		- i.g.mobile.ms.akadns.net

			- i1.mobile.microsoft.com

		- i.g.social.ms.akadns.net

			- i1.social.s-msft.com

		- res.windows.microsoft.com.edgesuite.net

			- a1737.g2.akamai.net
			- res2.windows.microsoft.com

		- wscont.apps.microsoft.com.edgesuite.net

			- wscont[12].apps.microsoft.com

		- az12410.vo.msecnd.net
		- az373151.vo.msecnd.net	(used on imaginecup.com)
		- msstore.vo.msecnd.net
		- officeimg.vo.msecnd.net

	msnportalmobileisv.112.2o7.net


	Nonfunctional domains:

		- www.buildmypinnedsite.com
		- (www.)imaginecup.com ***
		- compete.imaginecup.com ***

		- microsoft.com subdomains:

			- silverlight.dlservice *
			- download *
			- web.esd *		(esd, origin, origin-web, and web don't exist)
			- samples.msdn		(refused)
			- visualstudiogallery.msdn	(redirects to http, valid cert)
			- mymfe			(reset)
			- news			(Redirects to http)
			- officeimages
			- privacy		(times out)
			- academic.research ***
			- sharepoint		(redirects to login.live.com, cert valid)
			- vepexp		(refused)
			- edir.windowsm		(404)
			- visio **
			- (www.)windows **

		- msimg.com
		- blogs.office.com ***
		- blog.surface.com		(handshake fails)
		- (www.)windowsteamblog.com

	* 503, akamai
	** 404, cert valid
	*** Times out


	Problematic domains:

		- microsoft.com subdomains:

			- ^ ***
			- apps			(works; mismatched, CN: *.apps.microsoft.com)
			- wscont[12].apps	(works, akamai)
			- i[1-4].connect **
			- i **
			- i\d **
			- ie	(mismatched, CN: *.azurewebsites.net)
			- js **
			- i1.mobile **
			- scache **
			- search **
			- spcache		(504, akamai)
			- img3.store		(mismatched)
			- social.technet
			- update *
			- res[12].windows **

		- office.com

		- widgets.membership.s-msft.com		(akamai)
		- compass.surface.com **

	* Cert only matches www
	** akamai
	*** Times out
	⁷ Mixed css from i3.technet.microsoft.com and i1.social.s-msft.com

	Partially covered domains:

		- answers.microsoft.com		(some pages redirect to http)
		- code.msdn.microsoft.com	(pages redirect to http)
		- tag.microsoft.com ¹
		- social.technet.microsoft.com *

	¹ Some pages redirect to http
	* Avoiding false/broken MCB


	Fully covered domains:

		- microsoft.com subdomains:

			- accountservices
			- feedback.adcenter
			- ajax
			- fb.answers
			- next-services.apps
			- wscont.apps
			- wscont[12].apps	(→ wscont.apps)
			- advertise.bingads
			- secure.bingads
			- c
			- c1
			- choice
			- commerce

			- connect subdomains:

				- connect
				- i[1-4]		(→ services)
				- innovation
				- services

			- sas.css
			- social.expression
			- g
			- insider
			- m
			- widgets.membership
			- mobile
			- i1.mobile		(→ m)
			- social.msdn
			- support
			- dgps.support
			- support2
			- office15client
			- officepreview
			- officeredir
			- o15.officeredir
			- rad
			- scache		(→ www)
			- profileapi.services
			- social
			- services.social
			- spcache		( → www)
			- corp.sts
			- res[12].windows	(→ akamai)

		- (www.)office.com			(^ → www)
		- i.s-microsoft.com
		- widgets.membership.s-msft.com		(→ widgets.membership.microsoft.com)

		- *.sec.s-msft.com:

			- download-codeplex
			- i1.social		(→ social.microsoft.com)
			- i-technet
			- i2-technet


	These altnames don't exist:

		- secure.answers.microsoft.com
		- answers-sancert.microsoft.com


	Observed cookie domains:

		- .office.microsoft.com
		- support.microsoft.com *
		- .support.microsoft.com
		- .technet.microsoft.com ²
		- social.technet.microsoft.com ³

	* Secured by us <= not secured by server
	² Not secured by us <= used on domains subject to false MCB
	³ Some secured by us <= not secured by server


	Mixed content:

		- css, on:
		- css on onlinehelp from i3.onlinehelp *
			- social.technet from i3.technet *
			- social.technet from i1.social.s-msft.com *

		- Images, on:
			- insider from c *
		- Images on onlinehelp from i.onlinehelp *
			- support from $self *
		- Images on smallbusiness.support from support
		- Images on smallbusiness.support from www *
			- social.technet from i1.social.s-msft.com *

	* Secured by us

-->
<ruleset name="Microsoft (partial)">
	<target host="microsoft.com" />
	<target host="*.microsoft.com" />

        <exclusion pattern="^http://msdn\.microsoft\.com" />
        	<test url="http://msdn.microsoft.com/" />

		<!--
			https://mail1.eff.org/pipermail/https-everywhere-rules/2012-June/001189.html
											-->
		<exclusion pattern="^http://www\.microsoft\.com/.*[fF]amily[iI][dD]" />
			<!-- urls found by searching -->
			<test url="http://www.microsoft.com/genuine/downloads/WhyValidate.aspx?FamilyID=b446ae53-3759-40cf-80d5-cde4bbe07999&amp;displaylang=en" />
			<test url="https://www.microsoft.com/downloads/details.aspx?familyid=7FB6F2B8-C7A6-4239-99F3-CF3AACF89B0F" />
			<test url="http://www.microsoft.com/downloads/nl-nl/details.aspx?FamilyID=0a391abd-25c1-4fc0-919f-b21f31ab88b7" />
		<!--
			Health pages 404:

				https://trac.torproject.org/projects/tor/ticket/9148
											-->
		<exclusion pattern="^http://(www\.)?microsoft\.com/health/(?:$|\?|.+\.aspx)" />
			<test url="http://microsoft.com/health/" />
			<test url="http://www.microsoft.com/health/" />
			<test url="http://microsoft.com/health/?" />
			<test url="http://www.microsoft.com/health/?" />
			<test url="http://microsoft.com/health/en-au/Pages/index.aspx" />
			<test url="http://www.microsoft.com/health/en-au/Pages/index.aspx" />

		<!--
			Redirects via JS to http.  Very secure indeed.
									-->
		<exclusion pattern="^http://www\.microsoft\.com/security/.+\.aspx(?:$|\?)" />
		<test url="http://www.microsoft.com/security/pc-security/malware-symptoms.aspx" />
		<test url="http://www.microsoft.com/security/pc-security/updates.aspx" />
		<test url="http://www.microsoft.com/security/pc-security/malware-removal.aspx" />
		<test url="http://www.microsoft.com/security/pc-security/malware-symptoms.aspx?" />
		<test url="http://www.microsoft.com/security/pc-security/updates.aspx?" />
		<test url="http://www.microsoft.com/security/pc-security/malware-removal.aspx?" />

		<!--
			Microsoft won't serve OEM pages on https
								-->
    		<exclusion pattern="^http://(?:www\.)?microsoft\.com/[oO][eE][mM]/" />
			<test url="http://microsoft.com/oem/" />
			<test url="http://microsoft.com/OEM/" />
			<test url="http://microsoft.com/oEM/" />
			<test url="http://www.microsoft.com/oem/" />
			<test url="http://www.microsoft.com/OEM/" />
			<test url="http://www.microsoft.com/oEM/" />

		<!--
			Redirects to http:
						-->
		<exclusion pattern="^http://www\.microsoft\.com/Surface/\w\w-\w\w(?:$|\?|/)" />
		<exclusion pattern="^http://answers\.microsoft\.com/(?!\w\w-\w\w/\w+/forum/[\w-]+/[\w-]+/)" />
		<!--
			https://trac.torproject.org/projects/tor/ticket/5754
										-->
		<exclusion pattern="^http://msdn\.microsoft\.com/(?:$|en-us/$|.+(?:/$|\.aspx|/\w\w\d{6,10}$))" />
		<exclusion pattern="^http://code\.msdn\.microsoft\.com/(?![cC]content/|RequestReduceContent/)" />
		<!--
			Some data exist on www, exclude the rest here.
									-->
		<exclusion pattern="^http://search\.microsoft\.com/(?!global/oneMscomSettings/|shared/)" />
		<exclusion pattern="^http://technet\.microsoft\.com/(?!en-us/(?:library/[^\.]\.rss(?:$|\?)|security/(?:advisory|bulletin)(?:$|\?|/)))" />
		<!--
			Redirect to http:
						-->
		<exclusion pattern="^http://social\.technet\.microsoft\.com/Forums(?:$|[?/])" />
			<test url="http://social.technet.microsoft.com/Forums" />
			<test url="http://social.technet.microsoft.com/Forums?" />
			<test url="http://social.technet.microsoft.com/Forums/" />

		<!--exclusion pattern="^http://tag\.microsoft\.com/home\.aspx" /-->
		<exclusion pattern="^http://tag\.microsoft\.com/+(?![Aa]pp_[Tt]hemes/|favicon\.ico|Images/|[Ll]ibraries/|[Ww]eb[Rr]esource\.axd)" />
			<test url="http://tag.microsoft.com/" />
			<test url="http://tag.microsoft.com//" />
			<test url="http://tag.microsoft.com/?" />

		<!--
			Avoid false/broken MCB:
						-->
		<exclusion pattern="^http://social\.technet\.microsoft\.com/+wiki(?!/CustomWidgets/|/themes/|/Utility/)" />
			<test url="http://social.technet.microsoft.com/wiki/" />
			<test url="http://social.technet.microsoft.com//wiki" />
			<test url="http://social.technet.microsoft.com/wiki?" />
			<test url="http://social.technet.microsoft.com//wiki" />
			<test url="http://social.technet.microsoft.com/wiki/?" />
			<test url="http://social.technet.microsoft.com//wiki" />

		<!--
			Needed for Windows 8+ Captive Portal Helper:
			See https://github.com/EFForg/https-everywhere/issues/835
						-->
		<exclusion pattern="^http://go\.microsoft\.com/fwlink/\?LinkID=219472&amp;clcid=0x409$" />
			<test url="http://go.microsoft.com/fwlink/?LinkID=219472&amp;clcid=0x409" />

	<target host="office.com" />
	<target host="www.office.com" />
	<target host="i.s-microsoft.com" />
	<target host="*.s-msft.com" />


	<!--	Not secured by server:
					-->
	<!--securecookie host="^\.microsoft\.com$" name="^msdn$" /-->
	<!--securecookie host="^support\.microsoft\.com$" name="^(\.ASPXANONYMOUS|SMC_SAGE|smcexpsessionticket|smcexpticket)$" /-->
	<!--securecookie host="^smallbusiness\.support\.microsoft.com$" name="^(breadcrumb|culture|exitinfo)$" /-->
	<!--securecookie host="^\.technet\.microsoft\.com$" name="^AuthorizationCookie$" /-->
	<!--securecookie host="^social\.technet\.microsoft\.com$" name="^CSExtendedAnalytics(Session)?$" /-->

	<!--
		A, MC1, MS0: Cookies set by c.microsoft.com
		s_.+: Other tracking cookies
						-->
	<securecookie host="^\.microsoft\.com$" name="^(?:A|GsfxStatsLog|MC1|MS0|OnlineTrackingV2\.0|R|RioTracking\..+|s_.+)$" />
	<securecookie host="^(?:feedback\.adcenter|advertising|advertise\.bingads|choice|commerce|ieonline|m|\.?office|office(?:15client|2010|preview|redir)|corp\.sts|\.?support|\.?www)\.microsoft\.com$" name=".+" />
	<securecookie host="^social\.technet\.microsoft\.com$" name="^CSExtendedAnalytics(?:Session)?$" />
	<securecookie host="^www\.office\.com$" name=".+" />


	<rule from="^http://(?:i\d?\.|js\.|search\.|spcache\.)?microsoft\.com/"
		to="https://www.microsoft.com/" />
		<test url="http://i2.microsoft.com/" />
		<test url="http://i3.microsoft.com/" />
		<test url="http://i4.microsoft.com/" />
		<test url="http://js.microsoft.com/" />
		<test url="http://search.microsoft.com/" />
		<test url="http://spcache.microsoft.com/" />

	<rule from="^http://(accountservices|(?:feedback\.)?adcenter|advertising|ajax|(?:fb\.)?answers|c1?|choice|commerce|(?:innovation\.|services\.)?connect|sas\.css|events|social\.expression|go?|ieonline|insider|m|mobile|code\.msdn|msdn|social\.msdn|office(?:15client|365|2010|preview|redir)?|o15\.officeredir|profile|rad|research|profileapi\.services|signature|snackbox|(?:services\.)?social|store|corp\.sts|(dgps\.)?support|support2|tag|(?:social\.)?technet|www\.update|(?:v[45]\.)?windowsupdate)\.microsoft\.com/"
		to="https://$1.microsoft.com/" />
		<test url="http://accountservices.microsoft.com/" />
		<test url="http://adcenter.microsoft.com/" />
		<test url="http://feedbackadcenter.microsoft.com/" />
		<test url="http://advertising.microsoft.com/" />
		<test url="http://ajax.microsoft.com/" />
		<test url="http://answers.microsoft.com/" />
		<test url="http://answers.microsoft.com/" />
		<test url="http://fbanswers.microsoft.com/" />
		<test url="http://c.microsoft.com/" />
		<test url="http://c1.microsoft.com/" />
		<test url="http://choice.microsoft.com/" />
		<test url="http://commerce.microsoft.com/" />
		<test url="http://connect.microsoft.com/" />
		<test url="http://innovationconnect.microsoft.com/" />
		<test url="http://servicesconnect.microsoft.com/" />
		<test url="http://sas.css.microsoft.com/" />
		<test url="http://events.microsoft.com/" />
		<test url="http://social.expression.microsoft.com/" />
		<test url="http://g.microsoft.com/" />
		<test url="http://go.microsoft.com/" />
		<test url="http://ieonline.microsoft.com/" />
		<test url="http://insider.microsoft.com/" />
		<test url="http://m.microsoft.com/" />
		<test url="http://mobile.microsoft.com/" />
		<test url="http://code.msdn.microsoft.com/" />
		<test url="http://msdn.microsoft.com/" />
		<test url="http://social.msdn.microsoft.com/" />
		<test url="http://office.microsoft.com/" />
		<test url="http://office15client.microsoft.com/" />
		<test url="http://office365.microsoft.com/" />
		<test url="http://office2015.microsoft.com/" />
		<test url="http://officepreview.microsoft.com/" />
		<test url="http://officeredir.microsoft.com/" />
		<test url="http://o15.officeredir.microsoft.com/" />
		<test url="http://origin-res.windows.microsoft.com" />
		<test url="http://profile.microsoft.com/" />
		<test url="http://rad.microsoft.com/" />
		<test url="http://research.microsoft.com/" />
		<test url="http://profileapi.services.microsoft.com/" />
		<test url="http://signature.microsoft.com/" />
		<test url="http://snackbox.microsoft.com/" />
		<test url="http://social.microsoft.com/" />
		<test url="http://services.social.microsoft.com/" />
		<test url="http://store.microsoft.com/" />
		<test url="http://corp.sts.microsoft.com/" />
		<test url="http://support.microsoft.com/" />
		<test url="http://support2.microsoft.com/" />
		<test url="http://tag.microsoft.com/" />
		<test url="http://technet.microsoft.com/" />
		<test url="http://social.technet.microsoft.com/" />
		<test url="http://www.update.microsoft.com/" />
		<test url="http://windowsupdate.microsoft.com/" />
		<test url="http://v4.windowsupdate.microsoft.com/" />
		<test url="http://v5.windowsupdate.microsoft.com/" />

	<rule from="^http://wscont\d?\.apps\.microsoft\.com/"
		to="https://wscont.apps.microsoft.com/" />
		<test url="http://wscont.apps.microsoft.com/" />
		<test url="http://wscont1.apps.microsoft.com/" />
		<test url="http://wscont2.apps.microsoft.com/" />

	<rule from="^http://next-services\.apps\.microsoft\.com/"
		to="https://next-services.apps.microsoft.com/" />

	<rule from="^http://i\.s-microsoft\.com/"
		to="https://i.s-microsoft.com/" />
		<!-- test covered in target -->

	<rule from="^http://i\d\.social\.s-msft\.com/wiki/"
		to="https://social.technet.microsoft.com/wiki/" />
		<test url="http://i1.social.s-msft.com/wiki/" />
		<test url="http://i2.social.s-msft.com/wiki/" />
		<test url="http://i3.social.s-msft.com/wiki/" />

	<!--	Akamai with no valid cert.
						-->
	<rule from="^http://i\d?\.((?:code\.)?msdn|onlinehelp|(?:services\.)?social|(?:gallery\.)?technet)\.(?:microsoft|s-msft)\.com/"
		to="https://$1.microsoft.com/" />
		<test url="http://i1.code.msdn.microsoft.com" />
		<test url="http://i2.code.msdn.microsoft.com" />
		<test url="http://i1.code.msdn.s-msft.com" />
		<test url="http://i2.code.msdn.s-msft.com" />
		<test url="http://i1.msdn.microsoft.com" />
		<test url="http://i2.msdn.microsoft.com" />
		<test url="http://i1.msdn.s-msft.com" />
		<test url="http://i2.msdn.s-msft.com" />
		<test url="http://i1.onlinehelp.microsoft.com" />
		<test url="http://i2.onlinehelp.microsoft.com" />
		<test url="http://i1.onlinehelp.s-msft.com" />
		<test url="http://i2.onlinehelp.s-msft.com" />
		<test url="http://i1.services.social.microsoft.com" />
		<test url="http://i2.services.social.microsoft.com" />
		<test url="http://i1.services.social.s-msft.com" />
		<test url="http://i2.services.social.s-msft.com" />
		<test url="http://i1.social.microsoft.com" />
		<test url="http://i2.social.microsoft.com" />
		<test url="http://i1.social.s-msft.com" />
		<test url="http://i2.social.s-msft.com" />
		<test url="http://i1.technet.microsoft.com" />
		<test url="http://i2.technet.microsoft.com" />
		<test url="http://i1.technet.s-msft.com" />
		<test url="http://i2.technet.s-msft.com" />
		<test url="http://i1.gallery.technet.microsoft.com" />
		<test url="http://i2.gallery.technet.microsoft.com" />
		<test url="http://i1.gallery.technet.s-msft.com" />
		<test url="http://i2.gallery.technet.s-msft.com" />

	<rule from="^http://i\d\.connect\.microsoft\.com/"
		to="https://services.connect.microsoft.com/" />
		<test url="http://i1.services.connect.microsoft.com/" />
		<test url="http://i2.vservices.connect.microsoft.com/" />

	<rule from="^http://i1\.mobile\.microsoft\.com/"
		to="https://m.microsoft.com/" />
		<test url="http://i1.mobile.microsoft.com/" />

	<rule from="^http://scache\.microsoft\.com/"
		to="https://www.microsoft.com/" />
		<test url="http://scache.microsoft.com/" />

	<rule from="^http://img3\.store\.microsoft\.com/"
		to="https://msstore.vo.msecnd.net/" />
		<test url="http://img3.store.microsoft.com/" />

	<rule from="^http://update\.microsoft\.com/"
		to="https://www.update.microsoft.com/" />
		<test url="http://update.microsoft.com/" />

	<rule from="^http://res(1|2)\.windows\.microsoft\.com/"
		to="https://a248.e.akamai.net/f/1737/7533/6/res$1.windows.microsoft.com/" />
		<test url="http://res1.windows.microsoft.com/" />
		<test url="http://res2.windows.microsoft.com/" />

	<rule from="^http://(www\.)?office\.com/"
		to="https://www.office.com/" />
		<test url="http://www.office.com/" />
		<test url="http://office.com/" />

	<rule from="^http://download-codeplex\.sec\.s-msft\.com/"
		to="https://download-codeplex.sec.s-msft.com/" />
		<test url="http://download-codeplex.sec.s-msft.com/" />

	<rule from="^http://widgets\.membership\.(?:s-msft|microsoft)\.com/"
		to="https://widgets.membership.microsoft.com/" />
		<test url="http://widgets.membership.s-msft.com/" />
		<test url="http://widgets.membership.microsoft.com/" />

	<rule from="^http://i\d\.social\.s-msft\.com/"
		to="https://social.expression.microsoft.com/" />
		<test url="http://i1.social.s-msft.com/" />
		<test url="http://i2.social.s-msft.com/" />
		<test url="http://i3.social.s-msft.com/" />
</ruleset>