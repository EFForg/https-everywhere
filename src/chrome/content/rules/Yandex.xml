<!--
The following targets have been disabled at 2020-09-25 16:20:22:

Time: 2020-09-25 16:20:22
 Fetch error: http://www.maps.yandex.ru/ => https://maps.yandex.ru/: (6, 'Could not resolve host: www.maps.yandex.ru')

	Other Yandex rulesets:

		- BEM.info.xml
		- Loginza.ru.xml
		- Moikrug.ru.xml
		- Ya.ru.xml
		- YaDi.sk.xml
		- Yandex.com.xml
		- Yandex.com.ua.xml
		- Yandex.com.tr.xml
		- Yandex.kz.xml
		- Yandex.net.xml
		- Yandex.st.xml
		- Yandex.ua.xml
		- Yandex.by.xml
		- Yandex_ad_exchange.net.xml
		- Yaprobki.ru.xml
		- Yastatic.net.xml


	For any questions please contact Artyom Gavrichenkov <ximaera@yandex.ru>.

	I'm not in any way a Yandex employee, however, this set of rules is
	already working for a long time with all Yandex services, being used very
	intensively, and thus is being shared with community in order to prevent
	scam and stealing from Money.Yandex.ru (and other services as well).


	Nonfunctional subdomains:

		- apps ¹
		- android-us.apps ¹
		- us.apps ¹

		- beta-feedback ³
		- blog ³
		- bm ³
		- business ²
		- cards ³
		- contact ³
		- contact2 ³
		- copy ³
		- dns ³
		- encyclopedia *
    - ewent
		- family ¹
		- b.feedback ³
		- gazeta ³
		- informer ³
		- interactive-answers *
		- m.internet ³
		- ir ³
		- iseg ³
		- islands ¹
		- kapersky ³
		- kaspersky ³
		- kassa ⁴
		- labs ³
		- large ³
		- lingvo ³
		- m ¹
		- (www.)?market ¹
		- (www.)?m.metro ⁶
		- mirror ³
		- narod ²
		- navigator ³

		- (www.)?news ³
		- m.news ³
		- pda.news ³

		- notanymore ³
		- online ⁷
		- op ¹
		- presocial ⁶
		- prestable-pogoda ³
		- punto ⁶
		- api.rasp *
		- repo ³
		- shad ¹
		- soft ³
		- terms ³
		- uslugi ¹
		- interactive-answers.webmaster ¹
		- wdgt ⁵

	¹ Redirects to http
	² Refused
	³ Dropped
	* Differs from http
	⁴ Reset
	⁶ 404
	⁷ Shows mail
	⁵ 403


	Problematic subdomains:

		- www.advertising ¹
		- panoramas.api-maps *
		- appsearch ¹
		- www.browser **
		- pda.calendar ¹
		- collection ²
		- dict ¹
		- favicon ¹
		- m.market ⁵
		- www.mobile **
		- mobile-feedback ³

		- money ⁴
		- m.money ¹
		- pda.money ¹
		- start.money ⁴

		- skype ⁸
		- www.taras **
		- twitter ¹
		- upics ¹
		- streaming.video ⁹
		- webcal ¹
		- ym-promo ⁴

	¹ Mismatched
	* Unspecified effect[?]
	** 404
	² Mismatched, CN: bar.yandex.com.tr
	⁵ Revoked
	³ Mismatched, CN: validator.yandex.ru)
	⁴ Blocks Tor users
	⁸ Dropped
	⁹ Apparently breaks video player


	Partially covered subdomains:

		- (www.)?video *

	¹ Some pages redirect to http
	* Apparently breaks player


	Fully covered subdomains:

		- (www.)?
		- (www.)?academy
		- (www.)?adresa
		- (www.)?atlas
		- dict			(→ slovari)
		- \d+.downloader.disk
		- (www.)?ewents
		- (www.)?event
		- (www.)?events
		- favicon		(→ favicon.yandex.net)
		- (www.)?fotki
		- (www.)?internet
		- (www.)?ivent
		- (www.)?ivents
		- (www.)?karti

		- (www.)?maps
		- sandbox.api.maps
		- (www.)?beta.maps
		- (www.)?constructor.maps
		- (www.)?m.maps
		- (www.)?n.maps
		- (www.)?router-quality.maps

		- (www.)?master
		- (www.)?metro
		- mobile-feedback	(→ m.feedback)
		- (www.)?mshad
		- (www.)?music
		- (www.)?maps.pda
		- (www.)?pogoda
		- (www.)?probki
		- (www.)?research
		- (www.)?site
		- skype			(→ ^)
		- (www.)?startups
		- (www.)?tech
		- (www.)?tv
		- twitter		(→ www)
		- upics			(→ upics.yandex.net)
		- (www.)?weather
		- (www.)?yaca

		- ((www.)?[^.]+|[^.].[^.]): *	(www → ^)

			- (www.)?advertising
			- agency.advertising
			- welcome.advertising

			- advq
			- afisha
			- an
			- analytics
			- api
			- api-lenta
			- api-maps
			- arin.api-maps
			- enterprise.api-maps
			- api-yaru

			- auto
			- dealer.auto
			- m.auto
			- partner.auto
			- pda.auto

			- autoconfig
			- autodiscover
			- avia
			- awaps
			- b
			- ba
			- bar
			- bayan
			- beta.bayan
			- beta

			- blogs
			- m.blogs
			- pda.blogs

			- blogs-http
			- (www.)?browser
			- browsers
			- bs
			- bs-meta
			- buki
			- business-maps
			- calendar
			- widgets.calendar
			- captcha
			- changepassword
			- city
			- clck
			- clock
			- clocks
			- company

			- contest
			- algorithm.contest
			- intern.contest
			- official.contest

			- corba-https-export
			- corba-https-export-ng1
			- css
			- dev
			- direct
			- disc

			- disk
			- beta.disk
			- downloader.disk

			- display
			- element
			- elements
			- www.ewent
			- export
			- feedback
			- m.feedback
			- feedback2
			- files
			- firefox

			- img.fotki
			- m.fotki
			- r-img.fotki

			- fx
			- gadget
			- geocode-maps
			- geocontext
			- gorod
			- help
			- hw
			- i
			- ie
			- images
			- img
			- img-fotki
			- img[1-7]-fotki
			- ipv4.internet
			- ipv6.internet
			- keyboard
			- kiks
			- legal
			- m.legal
			- mail
			- pda.mail

			- har.maps
			- mpro.maps
			- mtquality.maps
			- npro.maps
			- pda.maps
			- points.maps
			- r.maps

			- constructor.maps
			- partner.market
			- mbrowser
			- mc
			- mdata
			- metr
			- metric
			- metrica
			- metrika
			- pda.metro
			- (www.)?mobile
			- money
			- start.money
			- myfiles
			- partner.news
			- opera
			- partner
			- partners
			- pass
			- passport
			- passport-ckicheck
			- probki.pda
			- traffic.pda
			- pda-passport
			- people
			- pdd
			- m.pogoda
			- mini.pogoda
			- prefetch-maps
			- probki
			- pda.probki
			- psearch-maps
			- pythonlbp-s
			- qas
			- qas2
			- rabota
			- m.rabota
			- radioprobki
			- radioprobki2

			- rasp
			- fi.rasp
			- m.rasp
			- suggests.rasp
			- suburban-widget.rasp
			- t.rasp

			- realty
			- partner.realty
			- route-maps
			- safety
			- search-maps
			- arin.search-maps
			- slovari
			- m.slovari
			- sobitia
			- m.soft
			- api.sport
			- sprav
			- spravochnik
			- stat
			- subs
			- suggest-maps
			- taras
			- taxi
			- taxi-exam
			- api.tech
			- developer.tech
			- technologies
			- ticket
			- time
			- tolstoy
			- pda.traffic
			- traffic-maps
			- translate
			- tune
			- m.tune
			- umbrella
			- validator
			- vb-update
			- video
			- static.video
			- vremya
			- watch
			- api.weather
			- mini.weather
			- webmaster
			- widgets
			- wy
			- xml
			- xmlsearch
			- yabs
			- m.yaca
			- pda.yaca
			- ye-update
			- ym-promo
			- m.zakladki

	* Except where excluded below


	These altnames don't exist:

		- m.feedback2.yandex.ru
		- store.yandex.ru
		- www.store.yandex.ru
		- support.yandex.ru
		- www.webmaster.yandex.ru


	Insecure cookies are set for these domains:

		- .yandex.ru
		- academy.yandex.ru
		- afisha.yandex.ru
		- auto.yandex.ru
		- bs.yandex.ru
		- captcha.yandex.ru
		- .captcha.yandex.ru
		- contest.yandex.ru
		- intern.contest.yandex.ru
		- shad.contest.yandex.ru
		- display.yandex.ru
		- feedback2.yandex.ru
		- .fotki.yandex.ru
		- gorod.yandex.ru
		- hw.yandex.ru
		- .hw.yandex.ru
		- internet.yandex.ru
		- ipv4.internet.yandex.ru
		- ipv6.internet.yandex.ru
		- mail.yandex.ru
		- partner.market.yandex.ru
		- mobile.yandex.ru
		- pass.yandex.ru
		- pogoda.yandex.ru
		- rabota.yandex.ru
		- m.rabota.yandex.ru
		- suggests.rasp.yandex.ru
		- .suggests.rasp.yandex.ru
		- realty.yandex.ru
		- partner.realty.yandex.ru
		- slovari.yandex.ru
		- startups.yandex.ru
		- stat.yandex.ru
		- tech.yandex.ru
		- developer.tech.yandex.ru
		- translate.yandex.ru
		- tune.yandex.ru


	Mixed content:

		- Images, on:

			- ^, b, corba-https-export, export, umbrella, vb-update, wy, ye-update from awaps.yandex.ru ¹
			- advertising from avatars.yandex.net ¹
			- advertising, b, m.blogs, corba-https-export, export, m.legal, umbrella, vb-update, wy, ye-update from img.yandex.net ¹
			- m.feedback, mobile-feedback, www from yastatic.net ¹
			- tech from api.yandex.ru ¹

		- favicons, on:

			- m.feedback from img.yandex.net ¹
			- agency.advertising, help, legal, m.legal from yandex.st ¹

		- Bugs, on:

			- m.blogs, downloader.disk, from clck.yandex.ru ¹
			- m.fotki from c.waplog.net ²
			- advq, ba, blogs, direct, maps, partner.market, maps.pda, rabota, wordstat, (www.)?yaca from kiks.yandex.ru ¹

	¹ Secured by us
	² Unsecurable <= dropped

-->
<ruleset name="Yandex">

	<target host="yandex.ru" />
	<target host="*.yandex.ru" />
    <test url="http://audience.yandex.ru/" />
    <test url="http://disk.yandex.ru/" />
    <test url="http://download.yandex.ru/" />
    <test url="http://academy.yandex.ru/" />
    <test url="http://video.yandex.ru/" />
    <test url="http://events.yandex.ru/" />

	<rule from="^http://(?:www\.)?([^.]+)\.yandex\.ru/"
		to="https://$1.yandex.ru/" />
    <test url="http://www.disk.yandex.ru/" />
    <test url="http://www.webmaster.yandex.ru/" />
    <test url="http://www.kassa.yandex.ru/" />

	<!--	Here we can enable 4+ level domains with a single regexp,
		but I've never seen any domains more that 4 levels deep
		in Yandex network, so I wouldn't enable them now -
		it may be inconvenient and may brake some services.
		Only 4-level domains match.
						-->
	<rule from="^http://([^.]+)\.([^.]+)\.yandex\.ru/"
		to="https://$1.$2.yandex.ru/" />
    <test url="http://points.maps.yandex.ru/" />
    <test url="http://beta.dialogs.yandex.ru/" />
    <test url="http://shad.contest.yandex.ru/" />

  <securecookie host=".+" name=".+" />

  <rule from="^http:" to="https:" />

</ruleset>
